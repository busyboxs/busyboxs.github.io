<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>【译】Tensorflow 与 Keras？通过构建图像分类模型来比较 | Busyboxs</title><meta name="keywords" content="medium,tensorflow"><meta name="author" content="Busyboxs"><meta name="copyright" content="Busyboxs"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="原文地址: https:&#x2F;&#x2F;hackernoon.com&#x2F;tensorflow-vs-keras-comparison-by-building-a-model-for-image-classification-f007f336c519  是的，标题中的问题在数据科学家之间的谈话中是很常见（甚至你！）。有人说TensorFlow更好，有人说Keras更好！让我们看看这个问题在图像分类的实际应用中的答">
<meta property="og:type" content="article">
<meta property="og:title" content="【译】Tensorflow 与 Keras？通过构建图像分类模型来比较">
<meta property="og:url" content="https://busyboxs.github.io/blogs/7bde1198/index.html">
<meta property="og:site_name" content="Busyboxs">
<meta property="og:description" content="原文地址: https:&#x2F;&#x2F;hackernoon.com&#x2F;tensorflow-vs-keras-comparison-by-building-a-model-for-image-classification-f007f336c519  是的，标题中的问题在数据科学家之间的谈话中是很常见（甚至你！）。有人说TensorFlow更好，有人说Keras更好！让我们看看这个问题在图像分类的实际应用中的答">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg">
<meta property="article:published_time" content="2018-09-14T14:22:22.000Z">
<meta property="article:modified_time" content="2019-08-13T02:31:12.131Z">
<meta property="article:author" content="Busyboxs">
<meta property="article:tag" content="medium">
<meta property="article:tag" content="tensorflow">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://busyboxs.github.io/blogs/7bde1198/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google_site_verification" content="FwkuU16DW0uUtLvBlI63aK9-eCBhC55pVQMscORY34M"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0737f86b9c26e7c4269a4dec38cea0c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-158970947-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-158970947-1');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lacquer&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【译】Tensorflow 与 Keras？通过构建图像分类模型来比较',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2019-08-13 10:31:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">92</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/img/archive_img.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Busyboxs</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【译】Tensorflow 与 Keras？通过构建图像分类模型来比较</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2018-09-14T14:22:22.000Z" title="发表于 2018-09-14 22:22:22">2018-09-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2019-08-13T02:31:12.131Z" title="更新于 2019-08-13 10:31:12">2019-08-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/medium/">medium</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【译】Tensorflow 与 Keras？通过构建图像分类模型来比较"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>原文地址: <a target="_blank" rel="noopener" href="https://hackernoon.com/tensorflow-vs-keras-comparison-by-building-a-model-for-image-classification-f007f336c519">https://hackernoon.com/tensorflow-vs-keras-comparison-by-building-a-model-for-image-classification-f007f336c519</a></p>
<hr>
<p>是的，标题中的问题在数据科学家之间的谈话中是很常见（甚至你！）。有人说TensorFlow更好，有人说Keras更好！让我们看看这个问题在图像分类的实际应用中的答案。</p>
<p>在此之前，先介绍Keras和Tensorflow这两个术语，帮助你在10分钟内构建强大的图像分类器！</p>
<h2 id="Tensorflow"><a href="#Tensorflow" class="headerlink" title="Tensorflow:"></a>Tensorflow:</h2><p>Tensorflow是开发深度学习模型最常用的库。它是有史以来最好的库，在日常实验中被许多极客选择。如果我说Google已经将Tensor Processing Units（TPU）用于处理张量，你能想象吗？是的，他们已经这样做了。他们提出了一个名为TPU的独立实例，它具有最强大的功率驱动计算能力来处理tensorflow的深度学习模型。</p>
<h2 id="Time-to-BUILD-IT-（是时候建立它了！）"><a href="#Time-to-BUILD-IT-（是时候建立它了！）" class="headerlink" title="Time to BUILD IT!（是时候建立它了！）"></a>Time to BUILD IT!（是时候建立它了！）</h2><p>我现在将帮助你使用tensorflow创建一个功能强大的图像分类器。等等！什么是分类器？这只是一个简单的问题，你向你的tensorflow代码询问，给定的图像是玫瑰还是郁金香。所以，首先的首先，让我们在机器上安装tensorflow。官方文档有两个版本，即CPU和GPU版本。对于CPU版本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install tensorflow</span><br></pre></td></tr></table></figure>
<p>请注意，我是在GPU上而非CPU上进行实验后才写的这篇博客。<a target="_blank" rel="noopener" href="https://www.tensorflow.org/install/">这里</a>给出了详细的GPU安装。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_001.png" alt=""></p>
<p>现在，让我们采用Google的Tensorflow进行实验来训练模型。谷歌的这个仓库有许多令人惊叹的处理图像的简单实验的脚本。它非常简洁，足以满足我们的目的。还记得前面我用过“强大”这个词吗？是的，当我们使用称为迁移学习的方法时，这个词就会生效。迁移学习是一种有效的方式，它使用预训练模型，这些模型已经训练了几天或几周，然后改变最后一层以适应我们自己的类别。</p>
<p>Inception V3是一个非常好的模型，在<a target="_blank" rel="noopener" href="http://image-net.org/challenges/LSVRC/2015/results">2015 ImageNet Challenge</a>图像分类竞赛中排名第二。当数据集的每个类别具有较少图像数量时，它被提及为迁移学习的最佳网络。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_002.png" alt=""></p>
<p>现在克隆git仓库：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/googlecodelabs/tensorflow-for-poets-2</span><br><span class="line"><span class="built_in">cd</span> tensorflow-for-poets-2</span><br></pre></td></tr></table></figure>
<p>现在，你可以选择图像。你所要做的就是以下面的方式存储数据集文件夹。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">— Dataset folder -</span><br><span class="line">       class1/</span><br><span class="line">           — image1</span><br><span class="line">           — image2</span><br><span class="line">       class2/</span><br><span class="line">           — image1</span><br><span class="line">           — image2</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_003.png" alt=""></p>
<p>它看起来应该像上面图那样（忽略image.py）。通过下面代码获得flower_photos文件夹：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://download.tensorflow.org/example_images/flower_photos.tgz | tar xz -C tf_files</span><br></pre></td></tr></table></figure>
<h3 id="Creating-the-Dataset"><a href="#Creating-the-Dataset" class="headerlink" title="Creating the Dataset"></a>Creating the Dataset</h3><p>你可以使用任何你喜欢的图像。越多越好（目标是几千）。向上面文件夹格式那样以类别将它们分开，并确保它们在一个名为<code>tf_files</code>的文件夹中。</p>
<p>你可以下载已经存在的有多种任务使用的数据集，如癌症检测，权力的游戏中的人物分类。<a target="_blank" rel="noopener" href="https://dataturks.com/projects/Trending?type=IMAGE_CLASSIFICATION">这里</a>有各种图像分类数据集。</p>
<p>或者，如果你有自己独特的用例，则可以为其创建自己的数据集。你可以从网上下载图像并立即制作大型数据集，使用像<a target="_blank" rel="noopener" href="https://dataturks.com/">Dataturks</a>这样的注释工具，你可以手动上传图像并标记图像。更好的是，Dataturks的输出可以很容易地用于构建<code>tf_files</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_004.png" alt=""></p>
<p>我发现了一个很棒的插件，可以在Google Chrome上批量下载图像。这个和Dataturks将使构建训练数据变得轻而易举。链接在<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/fatkun-batch-download-ima/nnjjahlikiabnchcpehcpkdeckfgnohf?hl=en">这里</a>。</p>
<p>您可以尝试使用dataturks的<a target="_blank" rel="noopener" href="https://dataturks.com/projects/import?type=IMAGE_CLASSIFICATION">image_classification工具</a>执行此操作。这里该工具提供的最佳功能是，如果我们有一个非结构化数据集，其中所有图像都在一个文件夹中。通过手动标记图像的类别，你可以下载一个json文件，该文件包含嵌入其中的类的图像的所有详细信息。然后使用下面给出的<a target="_blank" rel="noopener" href="https://gist.github.com/sameerg07/e296fe1f8e24933aa6eedd558047278c">keras</a>和<a target="_blank" rel="noopener" href="https://gist.github.com/sameerg07/4e0337ed2f77845edbb319633bd324e5">tensorflow</a>脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-------&gt; for tensorflow</span><br><span class="line">python3 tensorflow_json_parser.py — json_file “flower.json” — dataset_path “Dataset5/”</span><br><span class="line"></span><br><span class="line">-------&gt; for keras</span><br><span class="line">python3 keras_json_parser.py --json_file &quot;flower.json&quot; --dataset_path &quot;Dataset5/&quot; --train_percentage 80 --validation_percentage 20</span><br></pre></td></tr></table></figure>
<h3 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h3><p>现在是时候训练模型了。在tensorflow-for-poets-2文件夹中，有一个名为scripts的文件夹，它包含重新训练模型所需的一切。retrain.py有一种特殊的裁剪和缩放图像的方式，非常酷。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_005.png" alt=""></p>
<p>然后使用以下命令训练,选项名称本身描述所需的训练路径的位置。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 -m scripts.retrain \ </span><br><span class="line"> --bottleneck_dir=tf_files/bottlenecks \ </span><br><span class="line"> --model_dir=tf_files/models/inception \</span><br><span class="line"> --output_graph=tf_files/retrained_graph.pb \</span><br><span class="line"> --output_labels=tf_files/retrained_labels.txt \</span><br><span class="line"> --image_dir=tf_files/flower_photos</span><br></pre></td></tr></table></figure>
<p>这将下载inception模型并使用training文件夹和给定的参数训练最后一层。我使用12GB Nvidia Tesla k80和7GB Vram在GCP实例上训练了4000步。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_006.png" alt=""></p>
<p>训练时80%数据集用作训练，20%用作测试，我们可以看到，它给出了91％的test_accuracy。现在是时候测试了！我们在<code>tf_files/</code>中有一个.pb文件，可用于测试。<code>label_image.py</code>中添加了以下更改</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image,ImageDraw,ImageFont</span><br><span class="line">results = results.tolist()</span><br><span class="line">image = Image.<span class="built_in">open</span>(file_name)</span><br><span class="line">fonttype = ImageFont.truetype(“/usr/share/fonts/truetype/dejav/DejaVuSans.ttf”,<span class="number">18</span>)</span><br><span class="line"> </span><br><span class="line">draw = ImageDraw.Draw(image)</span><br><span class="line">draw.text(xy=(<span class="number">5</span>,<span class="number">5</span>),text=<span class="built_in">str</span>(labels[results.index(<span class="built_in">max</span>(results))])+”:”+<span class="built_in">str</span>(<span class="built_in">max</span>(results)),fill = (<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">128</span>),font = fonttype)</span><br><span class="line">image.show()</span><br><span class="line">image.save(file_name.split(“.”)[<span class="number">0</span>]+”<span class="number">1</span><span class="string">&quot;+”.jpg”)</span></span><br></pre></td></tr></table></figure>
<p>上面的代码将帮助我们绘制正在测试的图像的准确性并保存它。对于rodom图像的置信度百分比如下所示</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_007.png" alt=""></p>
<p>下面显示了几个测试图像的输出</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_008.jpeg" alt=""></p>
<p>正如我们所看到的，结果对于所述任务来说真的很好了。</p>
<h2 id="KERAS"><a href="#KERAS" class="headerlink" title="KERAS:"></a>KERAS:</h2><p>Keras是一个基于TensorFlow构建的高级API（也可以在Theano之上使用）。与Tensorflow相比，它更加用户友好且易于使用。如果我们是所有这些深度学习的新手，并想从头开始编写一个新模型，那么我会建议使用Keras，因为其易读性和易写性。可以通过下面指令安装：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install keras</span><br></pre></td></tr></table></figure>
<p>甚至这个东西都包含了tensorflow，所以CPU v/s GPU兼容性变化也将适用于此。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_009.png" alt=""></p>
<p>因为，我们必须执行使用inception模型的迁移学习对花进行分类的相同任务，我已经看到Keras以标准格式加载模型，如API编写的那样。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.applications.inception_v3 <span class="keyword">import</span> preprocess_input</span><br></pre></td></tr></table></figure>
<p>Keras有一种加载数据集的标准格式，即我们不是直接在数据集文件夹中提供文件夹，而是手动划分训练和测试数据，并按以下方式排列。我使用了我在tensorflow部分下载的相同数据集，并按照以下说明进行了一些更改。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">— Dataset folder -</span><br><span class="line">  — train/ </span><br><span class="line">       class1/</span><br><span class="line">          — image1</span><br><span class="line">          — image2</span><br><span class="line">       class2/</span><br><span class="line">          — image1</span><br><span class="line">          — image2</span><br><span class="line">  — test/ </span><br><span class="line">      class1/</span><br><span class="line">          — image1</span><br><span class="line">          — image2</span><br><span class="line">      class2/</span><br><span class="line">          — image1</span><br><span class="line">          — image2</span><br></pre></td></tr></table></figure>
<p>它看起来应该如下所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_010.png" alt=""></p>
<p>上面的训练和测试文件夹应该有如下所示的文件夹：</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_011.png" alt=""></p>
<p>至于，我们现在已完成数据集的设置，是时候进行训练了。我已经写了一小段代码来进行下面的训练：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> __version__</span><br><span class="line"><span class="keyword">from</span> keras.applications.inception_v3 <span class="keyword">import</span> InceptionV3, preprocess_input</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, GlobalAveragePooling2D</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> SGD</span><br><span class="line">IM_WIDTH, IM_HEIGHT = <span class="number">299</span>, <span class="number">299</span> <span class="comment">#fixed size for InceptionV3</span></span><br><span class="line">NB_EPOCHS = <span class="number">3</span></span><br><span class="line">BAT_SIZE = <span class="number">32</span></span><br><span class="line">FC_SIZE = <span class="number">1024</span></span><br><span class="line">NB_IV3_LAYERS_TO_FREEZE = <span class="number">172</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_nb_files</span>(<span class="params">directory</span>):</span><br><span class="line"> <span class="string">&quot;&quot;&quot;Get number of files by searching directory recursively&quot;&quot;&quot;</span></span><br><span class="line"> <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"> cnt = <span class="number">0</span></span><br><span class="line"> <span class="keyword">for</span> r, dirs, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line"> <span class="keyword">for</span> dr <span class="keyword">in</span> dirs:</span><br><span class="line"> cnt += <span class="built_in">len</span>(glob.glob(os.path.join(r, dr + <span class="string">&quot;/*&quot;</span>)))</span><br><span class="line"> <span class="keyword">return</span> cnt</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_to_transfer_learn</span>(<span class="params">model, base_model</span>):</span><br><span class="line"> <span class="string">&quot;&quot;&quot;Freeze all layers and compile the model&quot;&quot;&quot;</span></span><br><span class="line"> <span class="keyword">for</span> layer <span class="keyword">in</span> base_model.layers:</span><br><span class="line"> layer.trainable = <span class="literal">False</span></span><br><span class="line"> model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>, metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_new_last_layer</span>(<span class="params">base_model, nb_classes</span>):</span><br><span class="line"> <span class="string">&quot;&quot;&quot;Add last layer to the convnet</span></span><br><span class="line"><span class="string"> Args:</span></span><br><span class="line"><span class="string"> base_model: keras model excluding top</span></span><br><span class="line"><span class="string"> nb_classes: # of classes</span></span><br><span class="line"><span class="string"> Returns:</span></span><br><span class="line"><span class="string"> new keras model with last layer</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"> x = base_model.output</span><br><span class="line"> x = GlobalAveragePooling2D()(x)</span><br><span class="line"> x = Dense(FC_SIZE, activation=<span class="string">&#x27;relu&#x27;</span>)(x) <span class="comment">#new FC layer, random init</span></span><br><span class="line"> predictions = Dense(nb_classes, activation=<span class="string">&#x27;softmax&#x27;</span>)(x) <span class="comment">#new softmax layer</span></span><br><span class="line"> model = Model(<span class="built_in">input</span>=base_model.<span class="built_in">input</span>, output=predictions)</span><br><span class="line"> <span class="keyword">return</span> model</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_to_finetune</span>(<span class="params">model</span>):</span><br><span class="line"> <span class="string">&quot;&quot;&quot;Freeze the bottom NB_IV3_LAYERS and retrain the remaining top layers.</span></span><br><span class="line"><span class="string"> note: NB_IV3_LAYERS corresponds to the top 2 inception blocks in the inceptionv3 arch</span></span><br><span class="line"><span class="string"> Args:</span></span><br><span class="line"><span class="string"> model: keras model</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"> <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers[:NB_IV3_LAYERS_TO_FREEZE]:</span><br><span class="line"> layer.trainable = <span class="literal">False</span></span><br><span class="line"> <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers[NB_IV3_LAYERS_TO_FREEZE:]:</span><br><span class="line"> layer.trainable = <span class="literal">True</span></span><br><span class="line"> model.<span class="built_in">compile</span>(optimizer=SGD(lr=<span class="number">0.0001</span>, momentum=<span class="number">0.9</span>), loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>, metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">args</span>):</span><br><span class="line"> <span class="string">&quot;&quot;&quot;Use transfer learning and fine-tuning to train a network on a new dataset&quot;&quot;&quot;</span></span><br><span class="line"> nb_train_samples = get_nb_files(args.train_dir)</span><br><span class="line"> nb_classes = <span class="built_in">len</span>(glob.glob(args.train_dir + <span class="string">&quot;/*&quot;</span>))</span><br><span class="line"> nb_val_samples = get_nb_files(args.val_dir)</span><br><span class="line"> nb_epoch = <span class="built_in">int</span>(args.nb_epoch)</span><br><span class="line"> batch_size = <span class="built_in">int</span>(args.batch_size)</span><br><span class="line"><span class="comment"># data prep</span></span><br><span class="line"> train_datagen = ImageDataGenerator(</span><br><span class="line"> preprocessing_function=preprocess_input,</span><br><span class="line"> rotation_range=<span class="number">30</span>,</span><br><span class="line"> width_shift_range=<span class="number">0.2</span>,</span><br><span class="line"> height_shift_range=<span class="number">0.2</span>,</span><br><span class="line"> shear_range=<span class="number">0.2</span>,</span><br><span class="line"> zoom_range=<span class="number">0.2</span>,</span><br><span class="line"> horizontal_flip=<span class="literal">True</span></span><br><span class="line"> )</span><br><span class="line"> test_datagen = ImageDataGenerator(</span><br><span class="line"> preprocessing_function=preprocess_input,</span><br><span class="line"> rotation_range=<span class="number">30</span>,</span><br><span class="line"> width_shift_range=<span class="number">0.2</span>,</span><br><span class="line"> height_shift_range=<span class="number">0.2</span>,</span><br><span class="line"> shear_range=<span class="number">0.2</span>,</span><br><span class="line"> zoom_range=<span class="number">0.2</span>,</span><br><span class="line"> horizontal_flip=<span class="literal">True</span></span><br><span class="line"> )</span><br><span class="line">train_generator = train_datagen.flow_from_directory(</span><br><span class="line"> args.train_dir,</span><br><span class="line"> target_size=(IM_WIDTH, IM_HEIGHT),</span><br><span class="line"> batch_size=batch_size,</span><br><span class="line"> )</span><br><span class="line">validation_generator = test_datagen.flow_from_directory(</span><br><span class="line"> args.val_dir,</span><br><span class="line"> target_size=(IM_WIDTH, IM_HEIGHT),</span><br><span class="line"> batch_size=batch_size,</span><br><span class="line"> )</span><br><span class="line"><span class="comment"># setup model</span></span><br><span class="line"> base_model = InceptionV3(weights=<span class="string">&#x27;imagenet&#x27;</span>, include_top=<span class="literal">False</span>) <span class="comment">#include_top=False excludes final FC layer</span></span><br><span class="line"> model = add_new_last_layer(base_model, nb_classes)</span><br><span class="line"><span class="comment"># transfer learning</span></span><br><span class="line"> setup_to_transfer_learn(model, base_model)</span><br><span class="line">history_tl = model.fit_generator(</span><br><span class="line"> train_generator,</span><br><span class="line"> nb_epoch=nb_epoch,</span><br><span class="line"> samples_per_epoch=nb_train_samples,</span><br><span class="line"> validation_data=validation_generator,</span><br><span class="line"> nb_val_samples=nb_val_samples,</span><br><span class="line"> class_weight=<span class="string">&#x27;auto&#x27;</span>)</span><br><span class="line"><span class="comment"># fine-tuning</span></span><br><span class="line"> setup_to_finetune(model)</span><br><span class="line">history_ft = model.fit_generator(</span><br><span class="line"> train_generator,</span><br><span class="line"> samples_per_epoch=nb_train_samples,</span><br><span class="line"> nb_epoch=nb_epoch,</span><br><span class="line"> validation_data=validation_generator,</span><br><span class="line"> nb_val_samples=nb_val_samples,</span><br><span class="line"> class_weight=<span class="string">&#x27;auto&#x27;</span>)</span><br><span class="line">model.save(args.output_model_file)</span><br><span class="line"><span class="keyword">if</span> args.plot:</span><br><span class="line"> plot_training(history_ft)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot_training</span>(<span class="params">history</span>):</span><br><span class="line"> acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line"> val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line"> loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line"> val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"> epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(acc))</span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;r.&#x27;</span>)</span><br><span class="line"> plt.plot(epochs, val_acc, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"> plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.figure()</span><br><span class="line"> plt.plot(epochs, loss, <span class="string">&#x27;r.&#x27;</span>)</span><br><span class="line"> plt.plot(epochs, val_loss, <span class="string">&#x27;r-&#x27;</span>)</span><br><span class="line"> plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line"> plt.show()</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"> a = argparse.ArgumentParser()</span><br><span class="line"> a.add_argument(<span class="string">&quot; - train_dir&quot;</span>)</span><br><span class="line"> a.add_argument(<span class="string">&quot; - val_dir&quot;</span>)</span><br><span class="line"> a.add_argument(<span class="string">&quot; - nb_epoch&quot;</span>, default=NB_EPOCHS)</span><br><span class="line"> a.add_argument(<span class="string">&quot; - batch_size&quot;</span>, default=BAT_SIZE)</span><br><span class="line"> a.add_argument(<span class="string">&quot; - output_model_file&quot;</span>, default=<span class="string">&quot;inceptionv3-ft.model&quot;</span>)</span><br><span class="line"> a.add_argument(<span class="string">&quot; - plot&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>)</span><br><span class="line">args = a.parse_args()</span><br><span class="line"> <span class="keyword">if</span> args.train_dir <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> args.val_dir <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line"> a.print_help()</span><br><span class="line"> sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">not</span> os.path.exists(args.train_dir)) <span class="keyword">or</span> (<span class="keyword">not</span> os.path.exists(args.val_dir)):</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;directories do not exist&quot;</span>)</span><br><span class="line"> sys.exit(<span class="number">1</span>)</span><br><span class="line"> train(args)</span><br></pre></td></tr></table></figure>
<p>这段代码编写得很整齐，可以通过传递给下面命令的参数轻松理解：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 inception_train.py </span><br><span class="line"> — train_dir flower_photos/train \</span><br><span class="line"> — val_dir flower_photos/validation \ </span><br><span class="line"> — nb_epoch 50 \ </span><br><span class="line"> — batch_size 10 \ </span><br><span class="line"> — output_model_file inception_yo1.model</span><br></pre></td></tr></table></figure>
<p>我的GPU上训练一分钟1 epoch，每个epoch 292步，并且训练了50个epoch（这是非常多！），批量大小为10，数据分割为80%训练集，20%测试集。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_012.png" alt=""></p>
<p>哇哦。我们完成了训练并得到了约91%的测试准确率，损失为0.38。该模型已保存为一个inception.model文件，可以再次加载并测试。为此，编写了另一个脚本，同时在图像上绘制预测类别并保存它。测试脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image,ImageDraw,ImageFont</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">from</span> keras.applications.inception_v3 <span class="keyword">import</span> preprocess_input</span><br><span class="line">target_size = (<span class="number">229</span>, <span class="number">229</span>) <span class="comment">#fixed size for InceptionV3 architecture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">model, img, target_size</span>):</span><br><span class="line"> <span class="string">&quot;&quot;&quot;Run model prediction on image</span></span><br><span class="line"><span class="string"> Args:</span></span><br><span class="line"><span class="string"> model: keras model</span></span><br><span class="line"><span class="string"> img: PIL format image</span></span><br><span class="line"><span class="string"> target_size: (w,h) tuple</span></span><br><span class="line"><span class="string"> Returns:</span></span><br><span class="line"><span class="string"> list of predicted labels and their probabilities</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"> <span class="keyword">if</span> img.size != target_size:</span><br><span class="line"> img = img.resize(target_size)</span><br><span class="line">x = image.img_to_array(img)</span><br><span class="line"> x = np.expand_dims(x, axis=<span class="number">0</span>)</span><br><span class="line"> x = preprocess_input(x)</span><br><span class="line"> preds = model.predict(x)</span><br><span class="line"> <span class="keyword">return</span> preds[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot_preds</span>(<span class="params">image, preds</span>):</span><br><span class="line"> <span class="string">&quot;&quot;&quot;Displays image and the top-n predicted probabilities in a bar graph</span></span><br><span class="line"><span class="string"> Args:</span></span><br><span class="line"><span class="string"> image: PIL image</span></span><br><span class="line"><span class="string"> preds: list of predicted labels and their probabilities</span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span></span><br><span class="line"> plt.imshow(image)</span><br><span class="line"> plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">plt.figure()</span><br><span class="line"> labels = (<span class="string">&quot;daisy&quot;</span>, <span class="string">&quot;dandelion&quot;</span>,<span class="string">&quot;roses&quot;</span>,<span class="string">&quot;sunflower&quot;</span>,<span class="string">&quot;tulips&quot;</span>)</span><br><span class="line"> plt.barh([<span class="number">0</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], preds, alpha=<span class="number">0.5</span>)</span><br><span class="line"> plt.yticks([<span class="number">0</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], labels)</span><br><span class="line"> plt.xlabel(<span class="string">&#x27;Probability&#x27;</span>)</span><br><span class="line"> plt.xlim(<span class="number">0</span>,<span class="number">1.01</span>)</span><br><span class="line"> plt.tight_layout()</span><br><span class="line"> plt.show()</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"> a = argparse.ArgumentParser()</span><br><span class="line"> a.add_argument(<span class="string">&quot; - image&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;path to image&quot;</span>)</span><br><span class="line"> a.add_argument(<span class="string">&quot; - image_url&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;url to image&quot;</span>)</span><br><span class="line"> a.add_argument(<span class="string">&quot; - model&quot;</span>)</span><br><span class="line"> args = a.parse_args()</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> args.image <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> args.image_url <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line"> a.print_help()</span><br><span class="line"> sys.exit(<span class="number">1</span>)</span><br><span class="line">model = load_model(args.model)</span><br><span class="line"> model.fit()</span><br><span class="line"> <span class="keyword">if</span> args.image <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line"> labels = (<span class="string">&quot;daisy&quot;</span>, <span class="string">&quot;dandelion&quot;</span>,<span class="string">&quot;roses&quot;</span>,<span class="string">&quot;sunflower&quot;</span>,<span class="string">&quot;tulips&quot;</span>)</span><br><span class="line"> image1 = Image.<span class="built_in">open</span>(args.image)</span><br><span class="line"> preds = predict(model, image1, target_size) </span><br><span class="line"> <span class="built_in">print</span>(preds)</span><br><span class="line"> preds = preds.tolist()</span><br><span class="line"> plot_preds(image1, preds)</span><br><span class="line"> fonttype = ImageFont.truetype(<span class="string">&quot;/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf&quot;</span>,<span class="number">18</span>)</span><br><span class="line"> draw = ImageDraw.Draw(image1)</span><br><span class="line"> draw.text(xy=(<span class="number">5</span>,<span class="number">5</span>),text = <span class="built_in">str</span>(labels[preds.index(<span class="built_in">max</span>(preds))])+<span class="string">&quot;:&quot;</span>+<span class="built_in">str</span>(<span class="built_in">max</span>(preds)),fill = (<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">128</span>),font = fonttype)</span><br><span class="line"> image1.show()</span><br><span class="line"> image1.save((args.image).split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]+<span class="string">&quot;1&quot;</span>+<span class="string">&quot;.jpg&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>可以通过下面的命令进行测试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m scripts.label_image — graph=tf_files/retrained_graph.pb — image=rose.jpeg</span><br></pre></td></tr></table></figure>
<p>所有类别的预测置信度百分比输出如下</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_013.png" alt=""></p>
<p>以下是带图表的少数输出</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_014.jpeg" alt=""></p>
<p>最后！您已经学会了如何使用Keras和tensorflow构建强大的分类器。但是，哪一个是最好的仍然是我们头脑中的问题！因此，让我们仅根据此分类任务进行比较研究。</p>
<p>keras的全部训练和测试代码以及​​tensorflow的更改的脚本都可以在<a target="_blank" rel="noopener" href="https://github.com/sameerg07/FlowerClassification">我的github</a>中找到。</p>
<h2 id="Prototyping"><a href="#Prototyping" class="headerlink" title="Prototyping:"></a>Prototyping:</h2><p>如果你真的想快速编写代码并构建一个模型，那么Keras就是一个很好的选择。我们可以在几分钟内建立复杂模型！<code>Model</code>和<code>Sequential</code> API非常强大，因为它们易于使用，它们甚至不会让你感觉自己是构建强大的模型。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model = Sequential()</span><br><span class="line">model.add(Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_dim=<span class="number">100</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate dummy data</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data = np.random.random((<span class="number">1000</span>, <span class="number">100</span>))</span><br><span class="line">labels = np.random.randint(<span class="number">2</span>, size=(<span class="number">1000</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Train the model, iterating on the data in batches of 32 samples</span></span><br><span class="line">model.fit(data, labels, epochs=<span class="number">10</span>, batch_size=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
<p>就是这样，一个模型就准备好了！甚至相对于tensorflow，迁移学习在Keras中更容易编码实现。在你是一个非常厉害的程序员之前，Tensorflow从头开始编码都太难。</p>
<h3 id="从0开始以及灵活性"><a href="#从0开始以及灵活性" class="headerlink" title="从0开始以及灵活性"></a>从0开始以及灵活性</h3><p>由于与Keras相比tensorflow是一个低级库，相比于在Keras中，许多新功能可以在tensorflow中以更好的方式实现，例如，任何的激活函数等等。而且由于可用的参数更多，模型的微调和调整在tensorflow中比在Keras中非常灵活。</p>
<h3 id="训练时间和处理能力："><a href="#训练时间和处理能力：" class="headerlink" title="训练时间和处理能力："></a>训练时间和处理能力：</h3><p>上述模型是在相同的数据集上训练的，我们看到相比于tensorflow，Keras需要更多的时间进行训练。Tensorflow在15分钟内完成了4000步的训练，而Keras在50个epoch内花了大约2个小时。可能是我们无法比较epoch与步长，但在这种情况下你看到了，相比之下两者的测试准确度均为91％，因此我们可以描述keras训练比tensorflow慢一点。除此之外，由于tensorflow是一个低级库，因此它是有道理的。</p>
<h3 id="提供额外功能："><a href="#提供额外功能：" class="headerlink" title="提供额外功能："></a>提供额外功能：</h3><p>Tensorflow有一个内置的调试器，可以在训练期间调试以及生成图形。</p>
<p><img src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/blog/tensorflow-learn/tensorflow_keras_015.png" alt=""></p>
<p>Tensorflow甚至支持线程和队列来异步训练大型张量！这为TPU提供了更好，更快的处理速度。线程的示例代码如下所示：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create the graph, etc.</span></span><br><span class="line">init_op = tf.global_variables_initializer()</span><br><span class="line"><span class="comment"># Create a session for running operations in the Graph.</span></span><br><span class="line">sess = tf.Session()</span><br><span class="line"><span class="comment"># Initialize the variables (like the epoch counter).</span></span><br><span class="line">sess.run(init_op)</span><br><span class="line"><span class="comment"># Start input enqueue threads.</span></span><br><span class="line">coord = tf.train.Coordinator()</span><br><span class="line">threads = tf.train.start_queue_runners(sess=sess, coord=coord)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> coord.should_stop():</span><br><span class="line">        <span class="comment"># Run training steps or whatever</span></span><br><span class="line">        sess.run(train_op)</span><br><span class="line"><span class="keyword">except</span> tf.errors.OutOfRangeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Done training -- epoch limit reached&#x27;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># When done, ask the threads to stop.</span></span><br><span class="line">    coord.request_stop()</span><br><span class="line"><span class="comment"># Wait for threads to finish.</span></span><br><span class="line">coord.join(threads)</span><br><span class="line">sess.close()</span><br></pre></td></tr></table></figure>
<h3 id="监测和控制："><a href="#监测和控制：" class="headerlink" title="监测和控制："></a>监测和控制：</h3><p>根据我在深度学习方面的经验，我认为tensorflow非常适合许多情况，尽管它有点难度。例如，我们可以非常轻松地监控每个和所有内容，例如控制网络的权重和梯度。我们可以选择应该训练哪个步骤，哪个不应该。这在Keras中是不可行的。下面给出就是魔术！</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">step = tf.Variable(<span class="number">1</span>, trainable=<span class="literal">False</span>, dtype=tf.int32)</span><br></pre></td></tr></table></figure>
<h2 id="结论："><a href="#结论：" class="headerlink" title="结论："></a>结论：</h2><p>无论如何，Keras很快将被整合到tensorflow中！那么，为什么要去pythonic？（Keras是pythonic）。我的建议是花一些时间习惯tensorflow。上面的分类问题，如果您已经关注博客并相应地完成了相应的步骤，然后你会觉得相比于tensorflow，Keras在很多方面都little painful and patience killer。所以，尝试使用其他类，并尝试为应用程序训练分类器，如假笔记检测…</p>
<p>希望这篇博客能让你更好地了解何时使用它们！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://busyboxs.github.io">Busyboxs</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://busyboxs.github.io/blogs/7bde1198/">https://busyboxs.github.io/blogs/7bde1198/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://busyboxs.github.io" target="_blank">Busyboxs</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/medium/">medium</a><a class="post-meta__tags" href="/tags/tensorflow/">tensorflow</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/blogs/97eeec88/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">通过分析实例来理解TFRecord数据的读取与写入</div></div></a></div><div class="next-post pull-right"><a href="/blogs/6a4c5e1e/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/sign.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【译】基于深度学习的交通标志分类</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/blogs/6a4c5e1e/" title="【译】基于深度学习的交通标志分类"><img class="cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/sign.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-09-17</div><div class="title">【译】基于深度学习的交通标志分类</div></div></a></div><div><a href="/blogs/f77e32b8/" title="TFRecord 是什么？如何使用?"><img class="cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-08-26</div><div class="title">TFRecord 是什么？如何使用?</div></div></a></div><div><a href="/blogs/fe533d02/" title="tensorflow学习笔记（1）：TENSORFLOW&#39;S HELLO WORLD"><img class="cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-11</div><div class="title">tensorflow学习笔记（1）：TENSORFLOW&#39;S HELLO WORLD</div></div></a></div><div><a href="/blogs/233b154a/" title="tensorflow学习笔记（3）：LOGISTIC REGRESSION WITH TENSORFLOW"><img class="cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-27</div><div class="title">tensorflow学习笔记（3）：LOGISTIC REGRESSION WITH TENSORFLOW</div></div></a></div><div><a href="/blogs/94e07831/" title="tensorflow学习笔记（2）：LINEAR REGRESSION WITH TENSORFLOW"><img class="cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-27</div><div class="title">tensorflow学习笔记（2）：LINEAR REGRESSION WITH TENSORFLOW</div></div></a></div><div><a href="/blogs/2b14ee1d/" title="tensorflow学习笔记（4）：Activation Functions"><img class="cover" src="https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/covers/tensorflow.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-27</div><div class="title">tensorflow学习笔记（4）：Activation Functions</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tensorflow"><span class="toc-number">1.</span> <span class="toc-text">Tensorflow:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Time-to-BUILD-IT-%EF%BC%88%E6%98%AF%E6%97%B6%E5%80%99%E5%BB%BA%E7%AB%8B%E5%AE%83%E4%BA%86%EF%BC%81%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">Time to BUILD IT!（是时候建立它了！）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-the-Dataset"><span class="toc-number">2.1.</span> <span class="toc-text">Creating the Dataset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Training"><span class="toc-number">2.2.</span> <span class="toc-text">Training</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KERAS"><span class="toc-number">3.</span> <span class="toc-text">KERAS:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Prototyping"><span class="toc-number">4.</span> <span class="toc-text">Prototyping:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E0%E5%BC%80%E5%A7%8B%E4%BB%A5%E5%8F%8A%E7%81%B5%E6%B4%BB%E6%80%A7"><span class="toc-number">4.1.</span> <span class="toc-text">从0开始以及灵活性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E6%97%B6%E9%97%B4%E5%92%8C%E5%A4%84%E7%90%86%E8%83%BD%E5%8A%9B%EF%BC%9A"><span class="toc-number">4.2.</span> <span class="toc-text">训练时间和处理能力：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E4%BE%9B%E9%A2%9D%E5%A4%96%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">4.3.</span> <span class="toc-text">提供额外功能：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%B5%8B%E5%92%8C%E6%8E%A7%E5%88%B6%EF%BC%9A"><span class="toc-number">4.4.</span> <span class="toc-text">监测和控制：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">结论：</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/busyboxs/CDN@latest/img/archive_img.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By Busyboxs</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">❤🦋Stay foolish. Stay hungry.🦋❤</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="爱你哟,好好学习，天天向上,Stay hungry. Stay foolish.,✨✨✨,🎈🎈🎈,🎮🎮,♥♥♥♥,🏐🏐,🪂🪂" data-fontsize="10px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>